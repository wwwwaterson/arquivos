<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama Chatbot</title>
    <style>
        /* Minimal CSS for a clean look */
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f0f2f5; margin: 0; }
        .chat-container { width: 90%; max-width: 700px; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); }
        .chat-box { height: 400px; overflow-y: auto; padding: 15px; border: 1px solid #e5e5e5; border-radius: 8px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 10px 15px; border-radius: 20px; max-width: 80%; }
        .user-message { background: #007bff; color: white; align-self: flex-end; }
        .ollama-message { background: #e5e5e5; color: #333; align-self: flex-start; }
        .input-area { display: flex; gap: 10px; }
        .input-area input { flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 20px; }
        .input-area button { padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 20px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-box" id="chatBox">
            <div class="message ollama-message">Hello! How can I help you today?</div>
        </div>
        <div class="input-area">
            <input type="text" id="userMessage" placeholder="Type your message...">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
    <script>
        const chatBox = document.getElementById('chatBox');
        const userMessageInput = document.getElementById('userMessage');

        // Function to add a message to the chat box
        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', isUser ? 'user-message' : 'ollama-message');
            messageDiv.textContent = text;
            chatBox.appendChild(messageDiv);
            // Scroll to the latest message
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function sendMessage() {
            const userMessage = userMessageInput.value.trim();
            if (!userMessage) return;

            addMessage(userMessage, true);
            userMessageInput.value = '';

            const responseDiv = document.createElement('div');
            responseDiv.classList.add('message', 'ollama-message');
            responseDiv.textContent = 'Typing...';
            chatBox.appendChild(responseDiv);
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                // Request to the Ollama API (at http://localhost:11434)
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'gemma:2b', // Use the model you downloaded
                        prompt: userMessage,
                        stream: true // Stream the response in real-time
                    })
                });

                // Check for server errors
                if (!response.ok) throw new Error(response.status);

                // Process the streaming response
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullResponse = '';

                // Remove the "Typing..." message
                chatBox.removeChild(responseDiv);

                const ollamaResponseDiv = document.createElement('div');
                ollamaResponseDiv.classList.add('message', 'ollama-message');
                chatBox.appendChild(ollamaResponseDiv);
                chatBox.scrollTop = chatBox.scrollHeight;

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    for (const line of lines) {
                        if (!line.trim()) continue;
                        const data = JSON.parse(line);
                        if (!data.done) {
                            fullResponse += data.response;
                            ollamaResponseDiv.textContent = fullResponse;
                            chatBox.scrollTop = chatBox.scrollHeight;
                        }
                    }
                }
            } catch (error) {
                console.error('Error connecting to Ollama:', error);
                const errorDiv = document.createElement('div');
                errorDiv.classList.add('message', 'ollama-message');
                errorDiv.textContent = `Error: Could not connect to Ollama.`;
                chatBox.appendChild(errorDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        // Allow sending message by pressing 'Enter'
        userMessageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>
